<% greetings = ["Hello","Welcome back", "How you doin'"] 
 
  def current_user_gravatar
      size = 20
      gravatar_hash = Digest::MD5.hexdigest(current_user.email.downcase.strip)
      gravatar_url = "http://www.gravatar.com/avatar/#{gravatar_hash}?s=#{size}&d=mm"
      tag(:img, src: gravatar_url, class: "top-bar-avatar")
  end
%>

<div id="top-user-bar">
	<% if current_user %>
		<div id="top-bar-buttons" class="show">
			<p>
	    	<%#= greetings.sample %> <% if user_admin? current_user %> <small class="top-bar-admin-tag">admin</small> <%end%> <%= link_to current_user_gravatar+content_tag(:span,current_user.username, class: "top-bar-username"), user_path(current_user), class: "top-bar-user-url" %>  | <%= link_to "Log out", log_out_path %>
	    	</p>
	    </div>
	<% else %>
		<% if content_for? :top_user_bar %>
			<div id="top-bar-buttons" class="show">
				<p>
				<%= yield :top_user_bar %>
				</p>
		    </div>

		<%else %>
			<div id="top-bar-buttons" class="show">
				<p>
	    		<%= link_to "Sign up", sign_up_path %> or 
	    		<%= link_to "Log in", log_in_path, id: "top-bar-login-button" %>
	    		</p>
	    	</div>
	 	<% end %>
	<% end %>

	<div id="top-bar-auth" class="hidden">
		<%= form_tag log_in_path do %>
		    <%= text_field_tag :email, params[:email], placeholder: "username or email", required: ""%>
		    <%= password_field_tag :password,  "", placeholder: "password", required: "" %>
		  	<%= submit_tag "Log in" %>
			<span class="close">[<a href="#" title="Close Log in">x</a>]</span>
		<% end %>
	</div>
</div>